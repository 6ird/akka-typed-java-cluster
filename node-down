#!/bin/bash

# Use this script to down one Akka cluster node. The command line parameter must be from 1 to 9.

usage() {
  echo "Usage: $0 node - Down cluster node, node number must be 1 through 9." ; exit 1
}

downNode() {
  port="855"$1

  httpStatus=$(curl --write-out %{http_code} --silent --output /dev/null http://localhost:"$port"/cluster/members)

  if [[ $httpStatus == 200 ]] ; then
    curl --silent -X PUT -F "operation=Down" http://localhost:"$port"/cluster/members/cluster@127.0.0.1:255"$node" | python -m json.tool
    exit 0
  fi
}

[ $# -eq 0 ] && usage

node=$1

if [[ $node =~ ^[1-9]$ ]] ; then
  for i in $(seq 9) ; do downNode "$i" ; done
else
  echo "Cluster node number $node is invalid. The node number must be 1 through 9."
  usage
fi


echo "Unable to get a response from any cluster nodes."
exit 1
